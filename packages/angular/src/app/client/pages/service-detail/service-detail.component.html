<app-navbar></app-navbar>
<div class="wrap-body">
  <app-sidebar></app-sidebar>
  <div class="container-fluid">
    <!-- ##(Begin) Content -->
    <div class="rounded-3 px-3 py-2 my-2" style="background: #e9ecef;">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h4 class="text-uppercase">{{currentClient.fullName}}</h4>
          <p class="lead m-0">
            <a [routerLink]="['/client/detail', currentService.clientId]" class="font-weight-bold">
              {{ currentServicePlan.name }} "[{{ currentServicePlan.priceMonthly}}]" - {{currentService.ipAddress}}
            </a>
          </p>
        </div>
        <div class="btn-group">
          <button type="button" (click)="editServiceModal()" class="btn btn-primary">
            <i class="fas fa-edit"></i><span class="text-uppercase ms-1">Editar</span>
          </button>
          <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item text-uppercase" (click)="deleteServiceClick($event)" href="#">Borrar</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- ##(Begin) Tabs -->
    <nav class="d-print-none">
      <div class="nav nav-tabs" role="tablist">
        <button class="nav-link active" data-bs-toggle="tab"
                data-bs-target="#nav-payment" type="button" role="tab">
          <i class="far fa-credit-card"></i><span class="text-uppercase ms-1">Información de Pagos</span>
        </button>
        <button class="nav-link" data-bs-toggle="tab"
                data-bs-target="#nav-averias" type="button" role="tab">
          <i class="fas fa-phone-square-alt"></i><span class="text-uppercase ms-1">Registro de Averias</span>
        </button>
        <button class="nav-link" data-bs-toggle="tab"
                data-bs-target="#nav-status-change" type="button" role="tab">
          <i class="fas fa-exchange-alt"></i><span class="text-uppercase ms-1">Estado de Cambios</span>
        </button>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-payment" role="tabpanel">
        <!-- ##(Begin) Información de pagos -->
        <div class="row">
          <div class="col-12 d-print-none">
            <form class="row row-cols-auto g-2 mt-2">
              <div class="col-auto">
                <input type="number" [formControl]="paymentYearInput" class="form-control" placeholder="Year">
              </div>
              <div class="col-auto">
                <button type="button" (click)="getPaymentList()" class="btn btn-primary">
                  <i class="fas fa-sync"></i><span class="text-uppercase ms-1">Cargar</span>
                </button>
              </div>
              <div class="col-auto">
                <button type="button" (click)="addPaymentClick()" class="btn btn-success">
                  <i class="fas fa-money-check"></i><span class="text-uppercase ms-1">Pagar</span>
                </button>
              </div>
              <div class="col-auto">
                <button type="button" (click)="deletePayment()" class="btn btn-danger">
                  <i class="fas fa-trash-alt"></i><span class="text-uppercase ms-1">Borrar</span>
                </button>
              </div>
            </form>
          </div><!-- //.col-12-->
          <div class="col-12">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                <tr class="text-uppercase">
                  <th>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" disabled>
                    </div>
                  </th>
                  <th>Mes de Servicio</th>
                  <th>Monto</th>
                  <th>M.Pago</th>
                  <th>Fecha</th>
                  <th>User</th>
                  <th>Nota</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let payment of paymentList">
                  <td>
                    <div class="form-check">
                      <input type="checkbox" id="chkDel" [value]="payment._id" class="form-check-input">
                    </div>
                  </td>
                  <td>
                    <a [routerLink]="['/client/ticket', payment._id]">
                      {{getMonthName(payment.month)}} | {{payment.payFrom}} a {{payment.payUp}}
                    </a>
                  </td>
                  <td>{{payment.amount}}</td>
                  <td>{{payment.paymentMethod}}</td>
                  <td>{{payment.createdAt|date}}</td>
                  <td>{{payment.user?.fullName}}</td>
                  <td>{{payment.note}}</td>
                </tr>
                </tbody>
              </table>
            </div><!-- //.table-responsive -->
          </div><!-- //.col-12 -->
        </div><!-- //.row -->
        <!-- ##(End) Información de pagos -->
      </div>
      <div class="tab-pane fade" id="nav-averias" role="tabpanel">
        <!-- ##(Begin) Averias -->
        <form class="row row-cols-auto g-2 mt-2 d-print-none">
          <div class="col-auto">
            <input type="number" [formControl]="averiaYearInput" class="form-control" placeholder="Year">
          </div>
          <div class="col-auto">
            <button type="button" (click)="averiaListLoad()" class="btn btn-primary">
              <i class="fas fa-sync"></i><span class="text-uppercase ms-1">Cargar</span>
            </button>
          </div>
          <div class="col-auto">
            <button (click)="addAveriaClick()" class="btn btn-success">
              <i class="fas fa-plus"></i>
              <span class="text-uppercase ms-1">Registrar Averia</span>
            </button>
          </div>
        </form>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <tr class="text-uppercase">
              <th>Averia</th>
              <th></th>
              <th>Responsable</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let averia of averiaList">
              <td>
                <span class="d-block">{{averia.averia}}</span>
                <a [routerLink]="['/client/detail', currentClient._id]">
                  {{currentClient.fullName}} - {{currentClient.phone}}
                </a>
                <!-- COMENTARIO -->
                <div class="card px-2" *ngIf="averia.solution">{{averia.solution}}</div>
                <div class="d-flex">
                  <!-- ESTADO -->
                  <span class="me-1">
                  <ng-container *ngIf="averia.status === 'P'">
                    <span class="badge bg-primary">PENDIENTE</span>
                  </ng-container>
                  <ng-container *ngIf="averia.status === 'E'">
                    <span class="badge bg-warning text-white">EN PROCESO</span>
                  </ng-container>
                  <ng-container *ngIf="averia.status === 'F'">
                    <span class="badge bg-success">FINALIZADO</span>
                  </ng-container>
                  </span>
                  <!-- PRIORIDAD -->
                  <span class="ms-1">
                  <ng-container *ngIf="averia.priority === 'A'">
                    <span class="badge bg-danger">ALTA</span>
                  </ng-container>
                  <ng-container *ngIf="averia.priority === 'B'">
                    <span class="badge bg-info">BAJA</span>
                  </ng-container>
                  <ng-container *ngIf="averia.priority === 'M'">
                    <span class="badge bg-warning text-white">MEDIA</span>
                  </ng-container>
                  </span>
                </div>
                <span class="blockquote-footer">{{averia.createdAt}}</span>
              </td>
              <td class="text-center">
                <button (click)="attendAveriaClick(averia._id)" class="btn btn-info btn-sm">
                  <span class="text-uppercase">Atender</span>
                </button>
              </td>
              <td>
                <ng-container *ngIf="averia.user">
                  <span class="text-uppercase">{{averia.user.fullName}}</span>
                </ng-container>
              </td>
              <td>
                <div class="btn-opt ms-auto">
                  <button (click)="editAveriaClick(averia._id)" class="btn btn-secondary btn-sm me-2">
                    <i class="fas fa-edit"></i></button>
                  <button (click)="deleteAveriaClick(averia._id)" class="btn btn-danger btn-sm">
                    <i class="fas fa-trash-alt"></i></button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <!-- ##(End) Averias -->
      </div>
      <div class="tab-pane fade" id="nav-status-change" role="tabpanel">
        <!-- ##(Begin) Estado de cambios -->
        <form class="row row-cols-auto g-2 mt-2 d-print-none">
          <div class="col-auto">
            <input type="number" class="form-control" placeholder="Year">
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-primary">
              <i class="fas fa-sync"></i><span class="text-uppercase ms-1">Cargar</span>
            </button>
          </div>
          <div class="col-auto">
            <div class="btn-group">
              <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-cog"></i>
                <span class="text-uppercase ms-1">Opciones</span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="#">
                    <span class="text-uppercase">Habilitar</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <span class="text-uppercase">Suspender</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <span class="text-uppercase">Cambiar Plan</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <span class="text-uppercase">Registrar</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <span class="text-uppercase">Borrar</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-auto">
            <label class="col-form-label">
              <a href="#" class="fw-bold text-danger">[Cortes Antiguos]</a>
            </label>
          </div>
        </form>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <tr class="text-uppercase">
              <th>Tarea Realizada</th>
              <th>Fecha</th>
              <th>Responsable</th>
              <th>Nota</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>Registro del Servicio</td>
              <td>2021-05-21</td>
              <td>User1</td>
              <td></td>
            </tr>
            <tr>
              <td>Servicio Suspendido</td>
              <td>2021-07-12</td>
              <td>User1</td>
              <td>el servicio se suspende por 15 dias.</td>
            </tr>
            </tbody>
          </table>
        </div>
        <!-- ##(End) Estado de cambios -->
      </div>
    </div>
    <!-- ##(End) Tabs -->
    <app-service-modal
      [title]="titleService"
      [currentService]="currentService"
      (hideModal)="hideServiceModal($event)">
    </app-service-modal>
    <app-averia-modal
      [title]="titleAveria"
      [averia]="currentAveria"
      (sendModel)="saveChangeAveria($event)">
    </app-averia-modal>
    <app-averia-attend
      [averia]="currentAveria"
      (sendModel)="saveChangeAveria($event)">
    </app-averia-attend>
    <app-payment-modal
      [title]="titlePayment"
      [currentService]="currentService"
      [currentServicePlan]="currentServicePlan"
      (hideModal)="hidePaymentModal($event)">
    </app-payment-modal>
    <!-- ##(End) Content -->
  </div>
</div>
