<app-navbar></app-navbar>
<div class="wrap-body">
  <app-sidebar></app-sidebar>
  <div class="container-fluid">
    <!-- ##(Begin) Content -->
    <div class="rounded-3 px-3 py-2 my-2" style="background: #e9ecef;">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h4 class="text-uppercase">{{currentClient.fullName}}</h4>
          <p class="lead m-0">
            <a [routerLink]="['/client/detail', currentService.clientId]"
               class="font-weight-bold"
               [ngClass]="{'text-success': currentService.status === 'HABILITADO',
               'text-danger': currentService.status === 'SUSPENDIDO'}">
              {{ currentServicePlan.name }}
              <span class="fw-bold">
                "[{{ currentService.defPrice ?
                currentService.price : currentServicePlan.priceMonthly}}] {{currentService.paymentType}}"
              </span> - {{currentService.ipAddress}}
            </a>
          </p>
        </div>
        <div class="btn-group">
          <button type="button" (click)="editServiceModal()" class="btn btn-primary">
            <i class="fas fa-edit"></i><span class="text-uppercase ms-1">Editar</span>
          </button>
          <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <!--<li><a class="dropdown-item text-uppercase" (click)="detailServiceClick($event)" href="#">Detalle</a></li>-->
            <li><a class="dropdown-item text-uppercase" (click)="deleteServiceClick($event)" href="#">Borrar</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- ##(Begin) Tabs -->
    <nav class="d-print-none">
      <div class="nav nav-tabs" role="tablist">
        <button class="nav-link active" data-bs-toggle="tab"
                data-bs-target="#nav-payment" type="button" role="tab">
          <i class="far fa-credit-card"></i><span class="text-uppercase ms-1">Información de Pagos</span>
        </button>
        <button class="nav-link" data-bs-toggle="tab"
                data-bs-target="#nav-averias" type="button" role="tab">
          <i class="fas fa-phone-square-alt"></i><span class="text-uppercase ms-1">Registro de Averias</span>
        </button>
        <button class="nav-link" data-bs-toggle="tab"
                data-bs-target="#nav-status-change" type="button" role="tab">
          <i class="fas fa-exchange-alt"></i><span class="text-uppercase ms-1">Estado de Cambios</span>
        </button>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-payment" role="tabpanel">
        <!-- ##(Begin) Información de pagos -->
        <div class="row">
          <div class="col-12 d-print-none">
            <form class="row row-cols-auto g-2 mt-2">
              <div class="col-auto">
                <input type="number" [formControl]="paymentYearInput" class="form-control" placeholder="Year">
              </div>
              <div class="col-auto">
                <button type="button" (click)="getPaymentList()" class="btn btn-primary">
                  <i class="fas fa-sync"></i><span class="text-uppercase ms-1">Cargar</span>
                </button>
              </div>
              <div class="col-auto">
                <button type="button" (click)="addPaymentClick()" class="btn btn-success">
                  <i class="fas fa-money-check"></i><span class="text-uppercase ms-1">Pagar</span>
                </button>
              </div>
              <div class="col-auto">
                <button type="button" (click)="deletePayment()" class="btn btn-danger">
                  <i class="fas fa-trash-alt"></i><span class="text-uppercase ms-1">Borrar</span>
                </button>
              </div>
            </form>
          </div><!-- //.col-12-->
          <div class="col-12">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                <tr class="text-uppercase">
                  <th>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" disabled>
                    </div>
                  </th>
                  <th>Mes de Servicio</th>
                  <th>Monto</th>
                  <th>M.Pago</th>
                  <th>Fecha</th>
                  <th>User</th>
                  <th>Nota</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let payment of paymentList">
                  <td>
                    <div class="form-check">
                      <input type="checkbox" id="chkDel" [value]="payment._id" class="form-check-input">
                    </div>
                  </td>
                  <td>
                    <a [routerLink]="['/client/ticket', payment._id]">
                      {{getMonthName(payment.month)}} | {{payment.payFrom|date}} a {{payment.payUp|date}}
                    </a>
                  </td>
                  <td>{{payment.amount}}</td>
                  <td>{{payment.paymentMethod}}</td>
                  <td>{{payment.createdAt|date}}</td>
                  <td>{{payment.user?.fullName}}</td>
                  <td>{{payment.note}}</td>
                </tr>
                </tbody>
              </table>
            </div><!-- //.table-responsive -->
          </div><!-- //.col-12 -->
        </div><!-- //.row -->
        <!-- ##(End) Información de pagos -->
      </div>
      <div class="tab-pane fade" id="nav-averias" role="tabpanel">
        <!-- ##(Begin) Averias -->
        <app-averia-detail
          [currentService]="currentService"
          [currentClient]="currentClient"
          [currentAveria]="currentAveria">
        </app-averia-detail>
        <!-- ##(End) Averias -->
      </div>
      <div class="tab-pane fade" id="nav-status-change" role="tabpanel">
        <!-- ##(Begin) Estado de cambios -->
        <app-change-status [currentService]="currentService"></app-change-status>
        <!-- ##(End) Estado de cambios -->
      </div>
    </div>
    <!-- ##(End) Tabs -->
    <app-service-modal
      [title]="titleService"
      [currentService]="currentService"
      (hideModal)="hideServiceModal($event)">
    </app-service-modal>
    <app-payment-modal
      [title]="titlePayment"
      [currentService]="currentService"
      [currentServicePlan]="currentServicePlan"
      (hideModal)="hidePaymentModal($event)">
    </app-payment-modal>
    <!-- ##(End) Content -->
  </div>
</div>
