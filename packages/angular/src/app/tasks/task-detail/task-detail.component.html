<app-navbar></app-navbar>
<div class="wrap-body">
  <app-sidebar></app-sidebar>
  <div class="container-fluid">
    <div class="d-none d-print-block">
      <div class="d-flex align-items-center">
        <img src="assets/Logo.png" style="height: 120px;width: auto;" alt="Logo">
        <h1 class="font-weight-bold m-0" style="font-size: 4rem;">DIRECOM S.R.L.</h1>
      </div>
      <h5 class="font-weight-bold text-uppercase text-center">Distribuidora y Reparación de Computadoras, Servicio
        Técnico, Venta de
        suministros de cómputo, CCTV,
        Alarmas, Redes inalámbricas</h5>
      <hr class="my-1" style="border: solid 1px black;">
    </div><!-- //End Logo -->
    <div class="d-flex justify-content-between">
      <div class="mt-2">
        <h5 class="font-weight-bold card-title">{{task.title}}</h5>
        <p class="my-1">
          <span class="text-uppercase"><i class="fas fa-user"></i> Cliente: </span>
          <span>{{task.fullName}}</span>
        </p>
        <p class="my-1">
          <span class="text-uppercase"><i class="fas fa-map-marker-alt"></i> Dirección: </span>
          <span>{{task.address}}</span>
        </p>
        <p class="my-1">
          <span class="text-uppercase"><i class="fas fa-phone-alt"></i> Telefono: </span>
          <span>{{task.phoneNumber}}</span>
        </p>
        <p class="my-1">
          <span class="text-uppercase"><i class="fas fa-calendar-alt"></i> Fecha: </span>
          <span class="text-success">{{task.forDate}}</span>
        </p>
        <p class="mb-0">{{task.note}}</p>
      </div>
      <div class="d-flex flex-column justify-content-between">
        <span>&nbsp;</span>
        <ng-container *ngIf="task.status != 'N' && task.user">
          <p class="my-1">
            <span><i class="fas fa-user-circle"></i>&nbsp;</span>
            <span class="text-primary">{{task.user.name}}</span>
            <a href="#" *ngIf="task.status != 'F'"
               (click)="newStatusChangeTask($event)" class="text-danger ml-2">
              <i class="fas fa-times"></i></a>
          </p>
        </ng-container>
      </div>
    </div>
    <hr class="d-print-none my-1">
    <ng-container *ngIf="task.status == 'N'">
      <button (click)="addUserTech()" class="btn btn-primary">
        <i class="fas fa-user"></i>&nbsp;Agregar Técnico
      </button>
    </ng-container>
    <ng-container *ngIf="task.status == 'P'">
      <button (click)="addMaterial()" class="btn btn-primary mr-2 d-print-none">
        <i class="fas fa-box"></i>&nbsp;Agregar Materiales
      </button>
      <button (click)="finishTask()" class="btn btn-info d-print-none">
        <i class="fas fa-sign-out-alt"></i> Finalizar Tarea
      </button>
    </ng-container>
    <ng-container *ngIf="task.status == 'F' && isAdmin">
      <button (click)="enableTask()" class="btn btn-success">
        <i class="fas fa-sign-in-alt"></i> Habilitar Tarea
      </button>
    </ng-container>
    <ng-container *ngIf="task.status != 'N'">
      <div class="table-responsive">
        <table class="table table-sm mt-2">
          <thead class="thead-light">
          <tr class="text-uppercase">
            <th class="d-print-none">Cant.</th>
            <th>Und.</th>
            <th>Descripción</th>
            <th>Cant. <span class="d-print-none">Usada</span></th>
            <th>Precio</th>
            <th class="d-print-none">Diferencia</th>
            <th>Importe</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let material of taskMaterials">
            <td class="d-print-none">{{material.quantity1}}</td>
            <td>{{material.material.und}}</td>
            <td>{{material.material.description}}</td>
            <td>
              <app-quantity2
                [taskMaterial]="material"
                [statusTask]="task.status"
                (sendOnSave)="editMaterial($event)">
              </app-quantity2>
            </td>
            <td>
              <app-price
                [taskMaterial]="material"
                [statusTask]="task.status"
                (sendOnSave)="editMaterial($event)">
              </app-price>
            </td>
            <td class="d-print-none" style="width: 140px;">{{material.difference}}</td>
            <td>{{material.total|currency:undefined:'S/'}}</td>
            <td>
              <div class="float-right">
                <a href="#" *ngIf="task.status != 'F'"
                   (click)="deleteMaterial($event, material._id)">
                  <i class="fas fa-trash-alt"></i>
                </a>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="3">&nbsp;</td>
            <td class="d-print-none" colspan="2">&nbsp;</td>
            <td class="font-weight-bold text-center">TOTAL</td>
            <td class="font-weight-bold" style="color: navy;">{{getTotal()|currency:undefined:'S/'}}</td>
            <td>&nbsp;</td>
          </tr>
          </tbody>
        </table>
      </div>
      <a href="#" (click)="printPage($event)" class="d-print-none text-uppercase">Imprimir Página</a>
    </ng-container>
  </div>
  <app-add-material
    (sendModel)="saveChanges($event)">
  </app-add-material>
  <app-add-user
    (sendUserId)="setUserTech($event)">
  </app-add-user>
</div>
