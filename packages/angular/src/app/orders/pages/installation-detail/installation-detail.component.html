<app-navbar></app-navbar>
<div class="wrap-body">
  <app-sidebar></app-sidebar>
  <div class="container-fluid">
    <!-- ##(Begin) Content -->
    <div class="row">
      <div class="col-7 mt-2">
        <h4 class="text-uppercase mb-0">Detalles Orden de Instalación</h4>
        <hr class="mb-2 mt-0">
        <div>
          <ng-container *ngIf="userNotExist() else elseIf">
            <button type="button" data-bs-toggle="modal"
                    data-bs-target="#add-user-modal" class="btn btn-primary me-2">
              <i class="fas fa-user"></i><span class="text-uppercase ms-1">Agregar Técnico</span>
            </button>
          </ng-container>
          <ng-template #elseIf>
            <button type="button" data-bs-toggle="modal"
                    data-bs-target="#add-material-modal" class="btn btn-primary me-2">
              <i class="fas fa-box"></i><span class="text-uppercase ms-1">Agregar Material</span>
            </button>
            <button class="btn btn-info">
              <i class="fas fa-sign-out-alt"></i>
              <span class="text-uppercase ms-1">Finalizar Instalación</span>
            </button>
          </ng-template>
        </div>
        <div class="table-responsive">
          <table class="table table-striped mt-2">
            <thead>
            <tr>
              <th>SALIDA</th>
              <th>DESCRIPCIÓN</th>
              <th>RETORNO</th>
              <th>PRECIO</th>
              <th>USADO</th>
              <th>IMPORTE</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let material of orderMaterials">
              <td>{{material.quantity1}}</td>
              <td>{{material.description}}</td>
              <td>{{material.quantity2}}</td>
              <td>{{material.price}}</td>
              <td>{{material.difference}}</td>
              <td>{{material.total}}</td>
              <td>
                <button (click)="editItemMaterial(material._id)" class="btn btn-secondary btn-sm">
                  <i class="fas fa-cog"></i>
                </button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div>
          <a href="#" class="text-uppercase fw-bold">Registrar Servicio</a><br>
          <a [routerLink]="['/installation_orders/ticket',0]"
             class="text-uppercase fw-bold">Imprimir Ticket</a>
        </div>
      </div>
      <div class="col-5 mt-2">
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between">
              <h5 class="mb-0 card-title text-uppercase">Información</h5>
              <a [routerLink]="['/installation_orders/edit', currentInstallationOrder._id]">
                <i class="fas fa-edit"></i></a>
            </div>
          </div>
          <div class="card-body">
            <div class="d-flex justify-content-between border-bottom">
              <span>
                <i class="fas fa-calendar-alt"></i>
                Creado el
              </span>
              <span>{{currentInstallationOrder.createdAt}}</span>
            </div>
            <div class="d-flex justify-content-between border-bottom">
              <span><i class="fas fa-user"></i> Técnico</span>
              <span *ngIf="!userNotExist()">
                <a href="#" (click)="deleteUserTechnical($event)" class="text-danger me-1">
                  <i class="fas fa-times"></i></a>{{userTechnical?.fullName}}
              </span>
            </div>
            <div class="d-flex justify-content-between border-bottom">
              <span><i class="fas fa-user"></i> Cliente</span>
              <ng-container *ngIf="currentClient.fullName.length > 0">
                <a [routerLink]="['/client/detail', currentClient._id]">{{currentClient.fullName}}</a>
              </ng-container>
            </div>
            <div class="d-flex justify-content-between border-bottom">
              <span><i class="fas fa-map-marker-alt"></i> Dirección</span>
              <span>{{currentInstallationOrder.address}}</span>
            </div>
            <div class="d-flex justify-content-between border-bottom">
              <span><i class="fas fa-server"></i> Plan</span>
              <span>{{currentServicePlan.name}}</span>
            </div>
            <h5 class="text-uppercase"><i class="fas fa-map-marker-alt"></i> Ubicación del Cliente</h5>
            <!-- ##(Begin) map -->
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31015.952962683597!2d-73.39309230839163!3d-13.658121286107715!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x916d2bc7ff979013%3A0x7622e6cfe777add5!2sAndahuaylas!5e0!3m2!1ses!2spe!4v1624243954924!5m2!1ses!2spe"
              width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            <!-- ##(End) map -->
          </div>
        </div>
      </div>
    </div>
    <!-- ##(Begin) Componentes modales -->
    <app-add-user
      (hideModal)="hideUserModal($event)">
    </app-add-user>
    <app-add-material
      (hideModal)="hideMaterialModal($event)">
    </app-add-material>
    <app-item-material
      [orderMaterial]="orderMaterial"
      (hideModal)="hideItemMaterialModal($event)">
    </app-item-material>
    <!-- ##(End) Componentes modales -->
    <pre>{{currentInstallationOrder|json}}</pre>
    <pre>{{orderMaterials|json}}</pre>
    <!-- ##(End) Content -->
  </div>
</div>
